<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>სათევზაო ამინდის პროგნოზი</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .weather-container {
      background: rgba(0, 0, 0, 0.75);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .tab, .day-tab {
      background: rgba(255, 255, 255, 0.05);
      color: #e2e8f0;
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-size: 0.9rem;
      border: 1px solid transparent;
      min-width: 44px;
      text-align: center;
    }
    .tab.active, .day-tab.active {
      background: rgba(59, 130, 246, 0.2);
      color: #00ddeb;
      border: 1px solid #00ddeb;
      box-shadow: 0 0 8px rgba(0, 221, 235, 0.4);
    }
    .tab:hover, .day-tab:hover {
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 6px rgba(236, 72, 153, 0.2);
    }
    .weather-icon {
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
    }
    .weather-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.2s ease;
    }
    .weather-card:hover {
      box-shadow: 0 0 8px rgba(16, 185, 129, 0.3);
    }
    .header-icon {
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2300ddeb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-2-10h4l2 4h-4l-2-4z"/></svg>') no-repeat center;
      background-size: 28px;
    }
    body {
      background: linear-gradient(180deg, #0f172a, #1e293b);
    }
    @media (max-width: 640px) {
      .tab, .day-tab {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
      .weather-container {
        margin: 0 0.5rem;
      }
      .weather-card {
        padding: 10px;
      }
      #temperature {
        font-size: 2.5rem;
      }
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center py-6">
  <div class="weather-container text-white p-4 w-full max-w-md mx-4">
    <h1 class="text-xl font-bold mb-4 text-center flex items-center justify-center">
      <span class="header-icon w-7 h-7 mr-2"></span>
      სათევზაო ამინდი (20 მაისი, 2025)
    </h1>
    <!-- Location Tabs -->
    <div class="flex flex-wrap justify-center gap-1 mb-4">
      <button class="tab active" onclick="switchLocation('sion', 0)">სიონი</button>
      <button class="tab" onclick="switchLocation('tsalka', 0)">წალკა</button>
      <button class="tab" onclick="switchLocation('bazaleti', 0)">ბაზალეთი</button>
      <button class="tab" onclick="switchLocation('tbilisi', 0)">თბილისი</button>
      <button class="tab" onclick="switchLocation('rustavi', 0)">რუსთავი</button>
    </div>
    <!-- Day Tabs -->
    <div class="flex flex-wrap justify-center gap-1 mb-4" id="day-tabs">
      <!-- Day tabs will be populated dynamically -->
    </div>
    <!-- Weather Content -->
    <div id="weather-content" class="weather-card text-center">
      <img id="weather-icon" class="weather-icon mx-auto mb-3" src="" alt="Weather Icon" width="50">
      <p id="temperature" class="text-4xl font-semibold mb-2">-- °C</p>
      <p id="clouds" class="text-sm">ღრუბლიანობა: --%</p>
      <p id="precipitation" class="text-sm">ნალექის ალბათობა: --</p>
      <p id="pressure" class="text-sm">წნევა: -- hPa</p>
      <p id="wind" class="text-sm">ქარი: -- მ/წ, --</p>
      <p id="gust" class="text-sm">ქარის ნაკადი: --</p>
      <p id="fishing-tip" class="text-sm font-semibold text-cyan-300 mt-2">--</p>
    </div>
    <p class="text-xs text-center mt-4 opacity-75">მონაცემები OpenWeatherMap-ისგან. 10-დღიანი პროგნოზისთვის საჭიროა ფასიანი API.</p>
  </div>

  <script>
    const apiKey = 'b5f3b44e0ff36c689aa09e1c5f227d6d'; // Provided OpenWeatherMap API key
    const locations = {
      sion: { name: 'სიონი', lat: 41.6333, lon: 44.0833 },
      tsalka: { name: 'წალკა', lat: 41.5946, lon: 44.0891 },
      bazaleti: { name: 'ბაზალეთი', lat: 42.0833, lon: 44.6833 },
      tbilisi: { name: 'თბილისი', lat: 41.6941, lon: 44.8337 },
      rustavi: { name: 'რუსთავი', lat: 41.5495, lon: 44.9932 }
    };
    let currentLocation = 'sion';
    let currentDay = 0; // 0 for current weather, 1-7 for forecast days
    let forecastData = [];

    function degreesToDirection(degrees) {
      const directions = ['ჩ', 'ჩღ', 'ღ', 'ღა', 'ა', 'სა', 'ს', 'სდ', 'დ', 'დჩ', 'ჩ'];
      const index = Math.round(degrees / 33.75) % 11;
      return directions[index];
    }

    function getFishingTip(temp, cloudCover, windSpeed, pressure) {
      if (temp >= 15 && temp <= 25 && cloudCover >= 50 && windSpeed >= 2 && windSpeed <= 5 && pressure >= 1000 && pressure <= 1015) {
        return 'კარგი სათევზაო პირობები';
      } else if (cloudCover >= 70 && windSpeed <= 7) {
        return 'საშუალო სათევზაო პირობები';
      } else {
        return 'რთული სათევზაო პირობები';
      }
    }

    async function fetchCurrentWeather(lat, lon) {
      const apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=ka`;
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        return await response.json();
      } catch (error) {
        console.error('Error fetching current weather:', error);
        return null;
      }
    }

    async function fetchForecast(lat, lon) {
      const apiUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=ka`;
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        return data.list.filter((_, index) => index % 8 === 0).slice(0, 7);
      } catch (error) {
        console.error('Error fetching forecast:', error);
        return [];
      }
    }

    function updateDayTabs() {
      const dayTabs = document.getElementById('day-tabs');
      dayTabs.innerHTML = `
        <button class="day-tab ${currentDay === 0 ? 'active' : ''}" onclick="switchDay(0)">დღეს</button>
        ${forecastData.map((_, index) => `
          <button class="day-tab ${currentDay === index + 1 ? 'active' : ''}" onclick="switchDay(${index + 1})">
            ${new Date(_.dt * 1000).toLocaleDateString('ka-GE', { weekday: 'short', day: 'numeric', month: 'short' })}
          </button>
        `).join('')}
      `;
    }

    async function displayWeather(location, dayIndex) {
      const contentDiv = document.getElementById('weather-content');
      contentDiv.innerHTML = `
        <img id="weather-icon" class="weather-icon mx-auto mb-3" src="" alt="Weather Icon" width="50">
        <p id="temperature" class="text-4xl font-semibold mb-2">-- °C</p>
        <p id="clouds" class="text-sm">ღრუბლიანობა: --%</p>
        <p id="precipitation" class="text-sm">ნალექის ალბათობა: --</p>
        <p id="pressure" class="text-sm">წნევა: -- hPa</p>
        <p id="wind" class="text-sm">ქარი: -- მ/წ, --</p>
        <p id="gust" class="text-sm">ქარის ნაკადი: --</p>
        <p id="fishing-tip" class="text-sm font-semibold text-cyan-300 mt-2">--</p>
      `;

      if (dayIndex === 0) {
        const data = await fetchCurrentWeather(locations[location].lat, locations[location].lon);
        if (data) {
          document.getElementById('temperature').textContent = `${Math.round(data.main.temp)} °C`;
          document.getElementById('clouds').textContent = `ღრუბლიანობა: ${data.clouds.all}%`;
          document.getElementById('precipitation').textContent = `ნალექის ალბათობა: ${data.rain ? (data.rain['3h'] || 0) : 0} მმ`;
          document.getElementById('pressure').textContent = `წნევა: ${data.main.pressure} hPa`;
          document.getElementById('wind').textContent = `ქარი: ${data.wind.speed} მ/წ, ${degreesToDirection(data.wind.deg)}`;
          document.getElementById('gust').textContent = `ქარის ნაკადი: ${data.wind.gust ? data.wind.gust + ' მ/წ' : 'მიუწვდომელი'}`;
          document.getElementById('weather-icon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
          document.getElementById('fishing-tip').textContent = getFishingTip(
            data.main.temp,
            data.clouds.all,
            data.wind.speed,
            data.main.pressure
          );
        } else {
          contentDiv.innerHTML = '<p class="text-red-400 text-center">ვერ მოხერხდა ამინდის მონაცემების ჩატვირთვა. გთხოვთ, შეამოწმოთ API გასაღები ან ინტერნეტ კავშირი.</p>';
        }
      } else {
        const day = forecastData[dayIndex - 1];
        if (day) {
          document.getElementById('temperature').textContent = `${Math.round(day.main.temp)} °C`;
          document.getElementById('clouds').textContent = `ღრუბლიანობა: ${day.clouds.all}%`;
          document.getElementById('precipitation').textContent = `ნალექის ალბათობა: ${Math.round(day.pop * 100)}%`;
          document.getElementById('pressure').textContent = `წნევა: ${day.main.pressure} hPa`;
          document.getElementById('wind').textContent = `ქარი: ${day.wind.speed} მ/წ, ${degreesToDirection(day.wind.deg)}`;
          document.getElementById('gust').textContent = `ქარის ნაკადი: მიუწვდომელი`;
          document.getElementById('weather-icon').src = `https://openweathermap.org/img/wn/${day.weather[0].icon}@2x.png`;
          document.getElementById('fishing-tip').textContent = getFishingTip(
            day.main.temp,
            day.clouds.all,
            day.wind.speed,
            day.main.pressure
          );
        } else {
          contentDiv.innerHTML = '<p class="text-red-400 text-center">ვერ მოხერხდა პროგნოზის ჩატვირთვა</p>';
        }
      }
    }

    async function switchLocation(location, dayIndex) {
      currentLocation = location;
      currentDay = dayIndex;
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`button[onclick="switchLocation('${location}', ${dayIndex})"]`).classList.add('active');
      forecastData = await fetchForecast(locations[location].lat, locations[location].lon);
      updateDayTabs();
      displayWeather(location, dayIndex);
    }

    function switchDay(dayIndex) {
      currentDay = dayIndex;
      document.querySelectorAll('.day-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`button[onclick="switchDay(${dayIndex})"]`).classList.add('active');
      displayWeather(currentLocation, dayIndex);
    }

    // Initialize with Sion, current weather
    switchLocation('sion', 0);
  </script>
</body>
</html>
