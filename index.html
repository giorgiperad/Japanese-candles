<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>სათევზაო ამინდის პროგნოზი</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .weather-container {
      background: rgba(0, 0, 0, 0.75);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      overflow: hidden;
    }
    .weather-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,90 Q25,70 50,90 T100,90 V100 H0 Z" fill="rgba(16, 185, 129, 0.1)"/></svg>') repeat-x bottom;
      opacity: 0.3;
    }
    .tab, .view-tab, .day-tab {
      background: rgba(255, 255, 255, 0.05);
      color: #e2e8f0;
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-size: 0.9rem;
      border: 1px solid transparent;
      min-width: 44px;
      text-align: center;
      position: relative;
    }
    .tab.active, .view-tab.active, .day-tab.active {
      background: rgba(59, 130, 246, 0.2);
      color: #00ddeb;
      border: 1px solid #00ddeb;
      box-shadow: 0 0 8px rgba(0, 221, 235, 0.4);
    }
    .tab:hover, .view-tab:hover, .day-tab:hover {
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 6px rgba(236, 72, 153, 0.2);
      transform: translateY(-2px);
    }
    .weather-icon {
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
    }
    .weather-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.2s ease;
      position: relative;
    }
    .weather-card:hover {
      box-shadow: 0 0 8px rgba(16, 185, 129, 0.3);
    }
    .hourly-forecast {
      max-height: 300px;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #00ddeb rgba(255, 255, 255, 0.1);
    }
    .hourly-forecast::-webkit-scrollbar {
      width: 6px;
    }
    .hourly-forecast::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }
    .hourly-forecast::-webkit-scrollbar-thumb {
      background: #00ddeb;
      border-radius: 3px;
    }
    .header-icon {
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2300ddeb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-2-10h4l2 4h-4l-2-4z"/></svg>') no-repeat center;
      background-size: 28px;
    }
    .fishing-icon {
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2310b981"><path d="M12 15a3 3 0 100-6 3 3 0 000 6zM12 3v3M12 18v3M3 12h3M18 12h3"/></svg>') no-repeat center;
      background-size: 16px;
      width: 16px;
      height: 16px;
      display: inline-block;
      margin-right: 4px;
    }
    body {
      background: linear-gradient(180deg, #0f172a, #1e293b);
      font-family: 'Roboto', sans-serif;
    }
    @media (max-width: 640px) {
      .tab, .view-tab, .day-tab {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
      .weather-container {
        margin: 0 0.5rem;
      }
      .weather-card {
        padding: 10px;
      }
      #temperature {
        font-size: 2.5rem;
      }
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center py-6">
  <div class="weather-container text-white p-4 w-full max-w-md mx-4">
    <h1 class="text-xl font-bold mb-4 text-center flex items-center justify-center">
      <span class="header-icon w-7 h-7 mr-2"></span>
      სათევზაო ამინდი (20 მაისი, 2025, 17:50)
    </h1>
    <!-- Location Tabs -->
    <div class="flex flex-wrap justify-center gap-1 mb-4">
      <button class="tab active" onclick="switchLocation('tbilisi', 'current')"><span class="fishing-icon"></span>თბილისი</button>
      <button class="tab" onclick="switchLocation('tsalka', 'current')"><span class="fishing-icon"></span>წალკა</button>
      <button class="tab" onclick="switchLocation('bazaleti', 'current')"><span class="fishing-icon"></span>ბაზალეთი</button>
      <button class="tab" onclick="switchLocation('sion', 'current')"><span class="fishing-icon"></span>სიონი</button>
      <button class="tab" onclick="switchLocation('nadarbazevi', 'current')"><span class="fishing-icon"></span>ნადარბაზევი</button>
    </div>
    <!-- View Tabs -->
    <div class="flex flex-wrap justify-center gap-1 mb-4">
      <button class="view-tab active" onclick="switchView('current')">მიმდინარე</button>
      <button class="view-tab" onclick="switchView('hourly')">12-საათიანი</button>
      <button class="view-tab" onclick="switchView('daily')">5-დღიანი</button>
    </div>
    <!-- Day Tabs (for daily forecast) -->
    <div class="flex flex-wrap justify-center gap-1 mb-4 hidden" id="day-tabs">
      <!-- Day tabs will be populated dynamically -->
    </div>
    <!-- Weather Content -->
    <div id="weather-content" class="weather-card text-center">
      <p class="text-sm text-gray-400">ჩატვირთვა...</p>
    </div>
    <p class="text-xs text-center mt-4 opacity-75">მონაცემები OpenWeatherMap-ისგან. 10-დღიანი პროგნოზისთვის საჭიროა ფასიანი API.</p>
  </div>

  <script>
    const apiKey = 'b5f3b44e0ff36c689aa09e1c5f227d6d'; // OpenWeatherMap API key
    const locations = {
      tbilisi: { name: 'თბილისი', lat: 41.6941, lon: 44.8337 },
      tsalka: { name: 'წალკა', lat: 41.5946, lon: 44.0891 },
      bazaleti: { name: 'ბაზალეთი', lat: 42.0833, lon: 44.6833 },
      sion: { name: 'სიონი', lat: 41.6333, lon: 44.0833 },
      nadarbazevi: { name: 'ნადარბაზევი', lat: 41.5833, lon: 44.1167 }
    };
    let currentLocation = 'tbilisi';
    let currentView = 'current';
    let currentDay = 1; // Start with first forecast day
    let forecastData = { hourly: [], daily: [] };

    function degreesToDirection(degrees) {
      const directions = ['ჩ', 'ჩღ', 'ღ', 'ღა', 'ა', 'სა', 'ს', 'სდ', 'დ', 'დჩ', 'ჩ'];
      const index = Math.round(degrees / 33.75) % 11;
      return directions[index];
    }

    function getFishingTip(temp, cloudCover, windSpeed, pressure) {
      if (temp >= 15 && temp <= 25 && cloudCover >= 50 && windSpeed >= 2 && windSpeed <= 5 && pressure >= 1000 && pressure <= 1015) {
        return 'კარგი სათევზაო პირობები';
      } else if (cloudCover >= 70 && windSpeed <= 7) {
        return 'საშუალო სათევზაო პირობები';
      } else {
        return 'რთული სათევზაო პირობები';
      }
    }

    async function fetchCurrentWeather(lat, lon) {
      const apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=ka`;
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        return await response.json();
      } catch (error) {
        console.error('Error fetching current weather:', error);
        return null;
      }
    }

    async function fetchForecast(lat, lon) {
      const apiUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=ka`;
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        return await response.json();
      } catch (error) {
        console.error('Error fetching forecast:', error);
        return { list: [] };
      }
    }

    function aggregateDailyForecast(forecastList) {
      const daily = [];
      const dates = [...new Set(forecastList.map(item => new Date(item.dt * 1000).toLocaleDateString('ka-GE', { timeZone: 'Asia/Tbilisi' })))];
      dates.slice(1, 6).forEach(date => { // Start from tomorrow
        const dayData = forecastList.filter(item => new Date(item.dt * 1000).toLocaleDateString('ka-GE', { timeZone: 'Asia/Tbilisi' }) === date);
        const maxTemp = Math.max(...dayData.map(item => item.main.temp));
        const avgClouds = dayData.reduce((sum, item) => sum + item.clouds.all, 0) / dayData.length;
        const maxPop = Math.max(...dayData.map(item => (item.pop || 0) * 100));
        const avgPressure = dayData.reduce((sum, item) => sum + item.main.pressure, 0) / dayData.length;
        const avgWindSpeed = dayData.reduce((sum, item) => sum + item.wind.speed, 0) / dayData.length;
        const windDeg = dayData[Math.floor(dayData.length / 2)].wind.deg;
        const icon = dayData[Math.floor(dayData.length / 2)].weather[0].icon;
        daily.push({
          dt: dayData[0].dt,
          temp: maxTemp,
          clouds: avgClouds,
          pop: maxPop,
          pressure: avgPressure,
          wind_speed: avgWindSpeed,
          wind_deg: windDeg,
          icon: icon
        });
      });
      return daily;
    }

    function getHourlyForecast(forecastList) {
      const now = new Date();
      return forecastList.filter(item => {
        const itemTime = new Date(item.dt * 1000);
        const hoursDiff = (itemTime - now) / (1000 * 60 * 60);
        return hoursDiff >= 0 && hoursDiff <= 12;
      }).slice(0, 5); // Limit to ~12 hours (5 * 3-hour intervals)
    }

    function updateDayTabs() {
      const dayTabs = document.getElementById('day-tabs');
      if (currentView !== 'daily') {
        dayTabs.classList.add('hidden');
        return;
      }
      dayTabs.classList.remove('hidden');
      dayTabs.innerHTML = forecastData.daily.map((day, index) => `
        <button class="day-tab ${currentDay === index + 1 ? 'active' : ''}" onclick="switchDay(${index + 1})">
          ${new Date(day.dt * 1000).toLocaleDateString('ka-GE', { weekday: 'short', day: 'numeric', month: 'short', timeZone: 'Asia/Tbilisi' })}
        </button>
      `).join('');
    }

    async function displayWeather(location, view, dayIndex) {
      const contentDiv = document.getElementById('weather-content');
      if (view === 'current') {
        contentDiv.innerHTML = `
          <img id="weather-icon" class="weather-icon mx-auto mb-3" src="" alt="Weather Icon" width="50">
          <p id="temperature" class="text-4xl font-semibold mb-2">-- °C</p>
          <p id="clouds" class="text-sm">ღრუბლიანობა: --%</p>
          <p id="precipitation" class="text-sm">ნალექის ალბათობა: --</p>
          <p id="pressure" class="text-sm">წნევა: -- hPa</p>
          <p id="wind" class="text-sm">ქარი: -- მ/წ, --</p>
          <p id="gust" class="text-sm">ქარის ნაკადი: --</p>
          <p id="fishing-tip" class="text-sm font-semibold text-cyan-300 mt-2">--</p>
        `;
        const data = await fetchCurrentWeather(locations[location].lat, locations[location].lon);
        if (data) {
          document.getElementById('temperature').textContent = `${Math.round(data.main.temp)} °C`;
          document.getElementById('clouds').textContent = `ღრუბლიანობა: ${data.clouds.all}%`;
          document.getElementById('precipitation').textContent = `ნალექის ალბათობა: ${data.rain ? (data.rain['3h'] || 0) : 0} მმ`;
          document.getElementById('pressure').textContent = `წნევა: ${data.main.pressure} hPa`;
          document.getElementById('wind').textContent = `ქარი: ${data.wind.speed} მ/წ, ${degreesToDirection(data.wind.deg)}`;
          document.getElementById('gust').textContent = `ქარის ნაკადი: ${data.wind.gust ? data.wind.gust + ' მ/წ' : 'მიუწვდომელი'}`;
          document.getElementById('weather-icon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
          document.getElementById('fishing-tip').textContent = getFishingTip(
            data.main.temp,
            data.clouds.all,
            data.wind.speed,
            data.main.pressure
          );
        } else {
          contentDiv.innerHTML = '<p class="text-red-400 text-center">ვერ მოხერხდა ამინდის მონაცემების ჩატვირთვა. გთხოვთ, შეამოწმოთ API გასაღები ან ინტერნეტ კავშირი.</p>';
        }
      } else if (view === 'hourly') {
        contentDiv.innerHTML = '<div class="hourly-forecast text-sm"></div>';
        const hourlyDiv = contentDiv.querySelector('.hourly-forecast');
        const data = forecastData.hourly;
        if (data.length > 0) {
          data.forEach(hour => {
            const time = new Date(hour.dt * 1000).toLocaleTimeString('ka-GE', { hour: '2-digit', minute: '2-digit', timeZone: 'Asia/Tbilisi' });
            const card = `
              <div class="border-b border-gray-700 py-2">
                <p class="font-medium">${time}</p>
                <img src="https://openweathermap.org/img/wn/${hour.weather[0].icon}@2x.png" alt="Weather Icon" class="mx-auto my-1" width="30">
                <p>${Math.round(hour.main.temp)} °C</p>
                <p>ღრუბლიანობა: ${hour.clouds.all}%</p>
                <p>ნალექის ალბ.: ${Math.round(hour.pop * 100)}%</p>
                <p>ქარი: ${hour.wind.speed} მ/წ, ${degreesToDirection(hour.wind.deg)}</p>
                <p class="font-semibold text-cyan-300">${getFishingTip(
                  hour.main.temp,
                  hour.clouds.all,
                  hour.wind.speed,
                  hour.main.pressure
                )}</p>
              </div>
            `;
            hourlyDiv.innerHTML += card;
          });
        } else {
          hourlyDiv.innerHTML = '<p class="text-red-400 text-center">ვერ მოხერხდა საათობრივი პროგნოზის ჩატვირთვა</p>';
        }
      } else if (view === 'daily') {
        contentDiv.innerHTML = `
          <img id="weather-icon" class="weather-icon mx-auto mb-3" src="" alt="Weather Icon" width="50">
          <p id="temperature" class="text-4xl font-semibold mb-2">-- °C</p>
          <p id="clouds" class="text-sm">ღრუბლიანობა: --%</p>
          <p id="precipitation" class="text-sm">ნალექის ალბათობა: --</p>
          <p id="pressure" class="text-sm">წნევა: -- hPa</p>
          <p id="wind" class="text-sm">ქარი: -- მ/წ, --</p>
          <p id="gust" class="text-sm">ქარის ნაკადი: --</p>
          <p id="fishing-tip" class="text-sm font-semibold text-cyan-300 mt-2">--</p>
        `;
        const day = forecastData.daily[dayIndex - 1];
        if (day) {
          document.getElementById('temperature').textContent = `${Math.round(day.temp)} °C`;
          document.getElementById('clouds').textContent = `ღრუბლიანობა: ${Math.round(day.clouds)}%`;
          document.getElementById('precipitation').textContent = `ნალექის ალბათობა: ${Math.round(day.pop)}%`;
          document.getElementById('pressure').textContent = `წნევა: ${Math.round(day.pressure)} hPa`;
          document.getElementById('wind').textContent = `ქარი: ${day.wind_speed.toFixed(1)} მ/წ, ${degreesToDirection(day.wind_deg)}`;
          document.getElementById('gust').textContent = `ქარის ნაკადი: მიუწვდომელი`;
          document.getElementById('weather-icon').src = `https://openweathermap.org/img/wn/${day.icon}@2x.png`;
          document.getElementById('fishing-tip').textContent = getFishingTip(
            day.temp,
            day.clouds,
            day.wind_speed,
            day.pressure
          );
        } else {
          contentDiv.innerHTML = '<p class="text-red-400 text-center">ვერ მოხერხდა პროგნოზის ჩატვირთვა</p>';
        }
      }
    }

    async function switchLocation(location, view) {
      currentLocation = location;
      currentView = view;
      currentDay = 1; // Start with first forecast day
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`button[onclick="switchLocation('${location}', '${view}')"]`).classList.add('active');
      document.querySelectorAll('.view-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`button[onclick="switchView('${view}')"]`).classList.add('active');
      const forecast = await fetchForecast(locations[location].lat, locations[location].lon);
      forecastData.hourly = getHourlyForecast(forecast.list);
      forecastData.daily = aggregateDailyForecast(forecast.list);
      updateDayTabs();
      displayWeather(location, view, currentDay);
    }

    async function switchView(view) {
      currentView = view;
      currentDay = 1; // Start with first forecast day
      document.querySelectorAll('.view-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`button[onclick="switchView('${view}')"]`).classList.add('active');
      updateDayTabs();
      displayWeather(currentLocation, view, currentDay);
    }

    function switchDay(dayIndex) {
      currentDay = dayIndex;
      document.querySelectorAll('.day-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelector(`button[onclick="switchDay(${dayIndex})"]`).classList.add('active');
      displayWeather(currentLocation, currentView, dayIndex);
    }

    // Initialize with Tbilisi, current weather
    switchLocation('tbilisi', 'current').catch(error => {
      console.error('Initialization failed:', error);
      document.getElementById('weather-content').innerHTML = '<p class="text-red-400 text-center">ვერ მოხერხდა ინიციალიზაცია. გთხოვთ, შეამოწმოთ API გასაღები ან სცადოთ ხელახლა.</p>';
    });
  </script>
</body>
</html>
