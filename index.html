<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>სათევზაო ამინდის პროგნოზი - მრავალი ლოკაცია</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .weather-table {
      background: linear-gradient(135deg, #e6f3fa, #b3e0f2);
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    .weather-table th, .weather-table td {
      border: 1px solid rgba(0, 0, 0, 0.05);
      padding: 12px;
      text-align: center;
      vertical-align: middle;
    }
    .weather-table th {
      background: linear-gradient(135deg, #1e90ff, #00b7eb);
      color: white;
      font-weight: bold;
    }
    .weather-table tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.7);
    }
    .weather-table tr:hover {
      background: rgba(0, 191, 255, 0.1);
      transition: background 0.2s ease;
    }
    .weather-icon {
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }
    .forecast-cell {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
    }
    .forecast-day {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 8px;
      padding: 8px;
      min-width: 120px;
      transition: transform 0.2s ease;
    }
    .forecast-day:hover {
      transform: scale(1.05);
    }
    .scrollable {
      overflow-x: auto;
      max-width: 100%;
    }
    .header-icon {
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-2-10h4l2 4h-4l-2-4z"/></svg>') no-repeat center;
      background-size: 30px;
    }
  </style>
</head>
<body class="bg-blue-50 py-8">
  <div class="container mx-auto px-4">
    <h1 class="text-3xl font-bold text-center text-blue-800 mb-8 flex items-center justify-center">
      <span class="header-icon w-8 h-8 mr-2"></span>
      სათევზაო ამინდის პროგნოზი (20 მაისი, 2025)
    </h1>
    <div class="scrollable">
      <table id="weather-table" class="weather-table w-full">
        <thead>
          <tr>
            <th>ლოკაცია</th>
            <th>მიმდინარე სათევზაო ამინდი</th>
            <th>7-დღიანი პროგნოზი</th>
          </tr>
        </thead>
        <tbody id="weather-body">
          <!-- Table rows will be populated here -->
        </tbody>
      </table>
    </div>
    <p class="text-xs text-center mt-8 text-gray-600">მონაცემები OpenWeatherMap-ისგან. 10-დღიანი პროგნოზისთვის საჭიროა ფასიანი API.</p>
  </div>

  <script>
    const apiKey = 'b5f3b44e0ff36c689aa09e1c5f227d6d'; // Provided OpenWeatherMap API key
    const locations = [
      { id: 'darkha', name: 'დარყა', lat: 42.3167, lon: 42.9667 },
      { id: 'sion', name: 'სიონი', lat: 41.6333, lon: 44.0833 },
      { id: 'tsalka', name: 'წალკა', lat: 41.5946, lon: 44.0891 },
      { id: 'bazaleti', name: 'ბაზალეთი', lat: 42.0833, lon: 44.6833 },
      { id: 'tbilisi', name: 'თბილისი', lat: 41.6941, lon: 44.8337 },
      { id: 'rustavi', name: 'რუსთავი', lat: 41.5495, lon: 44.9932 }
    ];

    function degreesToDirection(degrees) {
      const directions = ['ჩ', 'ჩღ', 'ღ', 'ღა', 'ა', 'სა', 'ს', 'სდ', 'დ', 'დჩ', 'ჩ'];
      const index = Math.round(degrees / 33.75) % 11;
      return directions[index];
    }

    function getFishingTip(temp, cloudCover, windSpeed, pressure) {
      if (temp >= 15 && temp <= 25 && cloudCover >= 50 && windSpeed >= 2 && windSpeed <= 5 && pressure >= 1000 && pressure <= 1015) {
        return 'კარგი სათევზაო პირობები';
      } else if (cloudCover >= 70 && windSpeed <= 7) {
        return 'საშუალო სათევზაო პირობები';
      } else {
        return 'რთული სათევზაო პირობები';
      }
    }

    async function fetchCurrentWeather(lat, lon) {
      const apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=ka`;
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        return await response.json();
      } catch (error) {
        console.error('Error fetching current weather:', error);
        return null;
      }
    }

    async function fetchForecast(lat, lon) {
      const apiUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=ka`;
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        return data.list.filter((_, index) => index % 8 === 0).slice(0, 7); // Approximate daily data
      } catch (error) {
        console.error('Error fetching forecast:', error);
        return [];
      }
    }

    async function renderWeather() {
      const tbody = document.getElementById('weather-body');
      tbody.innerHTML = '';

      for (const location of locations) {
        const currentWeather = await fetchCurrentWeather(location.lat, location.lon);
        const forecastData = await fetchForecast(location.lat, location.lon);

        let currentWeatherHtml = '';
        if (currentWeather) {
          const windDirection = degreesToDirection(currentWeather.wind.deg);
          const windGust = currentWeather.wind.gust ? `${currentWeather.wind.gust} მ/წ` : 'მიუწვდომელი';
          const fishingTip = getFishingTip(
            currentWeather.main.temp,
            currentWeather.clouds.all,
            currentWeather.wind.speed,
            currentWeather.main.pressure
          );
          currentWeatherHtml = `
            <div class="flex flex-col items-center">
              <img class="weather-icon mb-2" src="https://openweathermap.org/img/wn/${currentWeather.weather[0].icon}@2x.png" alt="Weather Icon" width="60">
              <p class="text-xl font-semibold">${Math.round(currentWeather.main.temp)} °C</p>
              <p class="text-sm capitalize">${currentWeather.weather[0].description}</p>
              <p class="text-xs">ღრუბლიანობა: ${currentWeather.clouds.all}%</p>
              <p class="text-xs">ნალექის ალბათობა: ${currentWeather.rain ? currentWeather.rain['3h'] || '0' : '0'} მმ</p>
              <p class="text-xs">წნევა: ${currentWeather.main.pressure} hPa</p>
              <p class="text-xs">ქარი: ${currentWeather.wind.speed} მ/წ, ${windDirection}</p>
              <p class="text-xs">ქარის ნაკადი: ${windGust}</p>
              <p class="text-xs font-semibold text-blue-800 mt-2">${fishingTip}</p>
            </div>
          `;
        } else {
          currentWeatherHtml = '<p class="text-red-600 text-center">ვერ მოხერხდა ამინდის მონაცემების ჩატვირთვა. გთხოვთ, შეამოწმოთ API გასაღები ან ინტერნეტ კავშირი.</p>';
        }

        let forecastHtml = '';
        if (forecastData.length > 0) {
          forecastHtml = '<div class="forecast-cell">';
          forecastData.forEach(day => {
            const date = new Date(day.dt * 1000).toLocaleDateString('ka-GE', { weekday: 'short', day: 'numeric', month: 'short' });
            const windDirection = degreesToDirection(day.wind.deg);
            const pop = day.pop ? Math.round(day.pop * 100) : 0;
            const fishingTip = getFishingTip(
              day.main.temp,
              day.clouds.all,
              day.wind.speed,
              day.main.pressure
            );
            forecastHtml += `
              <div class="forecast-day">
                <p class="font-medium text-xs">${date}</p>
                <img src="https://openweathermap.org/img/wn/${day.weather[0].icon}.png" alt="Weather Icon" class="mx-auto my-1" width="40">
                <p class="text-sm">${Math.round(day.main.temp)} °C</p>
                <p class="text-xs capitalize">${day.weather[0].description}</p>
                <p class="text-xs">ღრუბლიანობა: ${day.clouds.all}%</p>
                <p class="text-xs">ნალექის ალბ.: ${pop}%</p>
                <p class="text-xs">წნევა: ${day.main.pressure} hPa</p>
                <p class="text-xs">ქარი: ${day.wind.speed} მ/წ, ${windDirection}</p>
                <p class="text-xs font-semibold text-blue-800 mt-1">${fishingTip}</p>
              </div>
            `;
          });
          forecastHtml += '</div>';
        } else {
          forecastHtml = '<p class="text-red-600 text-center">ვერ მოხერხდა პროგნოზის ჩატვირთვა</p>';
        }

        const rowHtml = `
          <tr>
            <td class="font-bold">${location.name}</td>
            <td>${currentWeatherHtml}</td>
            <td>${forecastHtml}</td>
          </tr>
        `;
        tbody.innerHTML += rowHtml;
      }
    }

    // Initialize
    renderWeather();
  </script>
</body>
</html>
